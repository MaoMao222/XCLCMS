var app={FileInfo:{}};app.FileInfo.List={Init:function(){$.XCheck()}},app.LogicFile={},app.LogicFile.List={Init:function(){var e=this;$.XCheck(),$("#btnBatchDel").on("click",function(){return e.DelSubmit($(":checkbox.xcheckValue").val()),!1}),$("#btnSelectFiles").on("click",function(){return e.SelectFiles($(":checkbox.xcheckValue").val(),$(this).attr("callback")),!1})},DelSubmit:function(e){if(!e)return art.dialog.tips("请指定要删除的记录！"),!1;art.dialog.confirm("您确定要删除此信息吗？",function(){$.XGoAjax({ajax:[{data:{attachmentIDs:e},url:AppConfig.RootUrl+"LogicFile/DelSubmit",type:"POST"}]})},function(){})},SelectFiles:function(e,t){if(!e||!t)return art.dialog.tips("请先选择文件再操作！"),!1;art.dialog.opener[t].call(null,e);var i=art.dialog.open.api;i&&i.close()}},app.LogicFile.Update={Init:function(){var e=this;$("#btnSave").on("click",function(){return e.SaveSubmit(),!1})},SaveSubmit:function(){$.XGoAjax({isExclusive:!0,id:"btnSave"})}},angular.module("ngFileInfo",[]).controller("fileInfoList",["$scope",function(i){i.data=[],i.initList=function(){$.XGoAjax({isExclusive:!0,id:"getFileList",ajax:{url:AppConfig.RootUrl+"FileInfo/GetFileList"},success:function(e,t){i.data=t.CustomObject||[],i.$apply()}})},i.initList(),i.delSubmit=function(e){if(!e)return art.dialog.tips("请指定要删除的文件！"),!1;art.dialog.confirm("您确定要删除此文件吗？",function(){$.XGoAjax({ajax:[{data:{paths:e},url:AppConfig.RootUrl+"FileInfo/DelSubmit",type:"POST"}],complete:function(){i.initList()}})},function(){})},i.delBatchSubmit=function(){i.delSubmit($(":checkbox.xcheckValue").val())}}]).filter("encodeURIComponent",function(){return window.encodeURIComponent}),angular.module("ngUpload",[]).controller("fileUpload",["$scope",function(o){var t=$("#tabFileUpload"),r=function(){this.IsImage=!1,this.Path="",this.ImgSmallPath="",this.ImgBigPath="",this.Id="",this.Size="",this.Format="",this.Name="",this.ImgWidth=0,this.ImgHeight=0,this.ImgPreviewWidth=0,this.ImgPreviewHeight=0,this.ImgPreviewRatio=0,this.X1=0,this.Y1=0,this.X2=0,this.Y2=0,this.W=0,this.H=0,this.ImgX1=0,this.ImgY1=0,this.ImgX2=0,this.ImgY2=0,this.ImgCropWidth=0,this.ImgCropHeight=0,this.ThumbImgSettings=[],this.Title="",this.ViewType="NOR",this.DownloadCount=0,this.ViewCount=0,this.Description="",this.IsUploadSuccess=!1,this.UploadMsg=""},i=function(){this.Width=0,this.Height=0};o.FileModelList=[],o.IsCanAddFile=!0,o.IsCanUploadFile=!0,o.IsCanOperateFileItem=!0;var l=o.CurrentFileModel=null,n=null,a=function(i){var l=null;return o.FileModelList&&$.each(o.FileModelList,function(e,t){if(t.Id==i)return l=t,!1}),l},s=function(e){e?(l.disableBrowse(!1),o.IsCanAddFile=!0,o.IsCanUploadFile=!0,o.IsCanOperateFileItem=!0):(l.disableBrowse(!0),o.IsCanAddFile=!1,o.IsCanUploadFile=!1,o.IsCanOperateFileItem=!1,o.CurrentFileModel=null)};o.startUpload=function(){l&&l.start()},o.clearFunction=function(){$("#fileUploaderProgress").progressbar("setValue",0),o.FileModelList=[],o.CurrentFileModel=null,l.splice(0,l.files.length),l.refresh(),s(!0)},o.fileEditFunction=function(e){if(t.tabs("select","文件设置"),o.CurrentFileModel&&e==o.CurrentFileModel.Id)return!1;n&&n.destroy(),o.CurrentFileModel=a(e),null!=o.CurrentFileModel.ThumbImgSettings&&0!=o.CurrentFileModel.ThumbImgSettings.length||(o.CurrentFileModel.ThumbImgSettings=[new i])},o.fileDetailFunction=function(e){if(t.tabs("select","文件详情"),o.CurrentFileModel&&e==o.CurrentFileModel.Id)return!1;n&&n.destroy(),o.CurrentFileModel=a(e)},o.fileDelFunction=function(e){var t;l.removeFile(e),t=e,o.FileModelList&&(o.FileModelList=$.map(o.FileModelList,function(e){return e.Id==t?null:e})),o.CurrentFileModel&&t===o.CurrentFileModel.Id&&(o.CurrentFileModel=null)};var e=function(e){o.CurrentFileModel.X1=e.x,o.CurrentFileModel.X2=e.x2,o.CurrentFileModel.Y1=e.y,o.CurrentFileModel.Y2=e.y2,o.CurrentFileModel.W=e.w,o.CurrentFileModel.H=e.h,o.CurrentFileModel.ImgX1=parseInt(e.x/o.CurrentFileModel.ImgPreviewRatio),o.CurrentFileModel.ImgX2=parseInt(e.x2/o.CurrentFileModel.ImgPreviewRatio),o.CurrentFileModel.ImgY1=parseInt(e.y/o.CurrentFileModel.ImgPreviewRatio),o.CurrentFileModel.ImgY2=parseInt(e.y2/o.CurrentFileModel.ImgPreviewRatio),o.CurrentFileModel.ImgCropWidth=parseInt(e.w/o.CurrentFileModel.ImgPreviewRatio),o.CurrentFileModel.ImgCropHeight=parseInt(e.h/o.CurrentFileModel.ImgPreviewRatio)};o.showSourceImg=function(){$("#formShowImg").submit()},o.thumbImgSettingAdd=function(){o.CurrentFileModel.ThumbImgSettings.push(new i)},o.thumbImgSettingDel=function(e){o.CurrentFileModel.ThumbImgSettings.splice(e,1)};var u=function(e){e.Width?e.Height=XJ.Data.GetInt(e.Width*o.CurrentFileModel.ImgCropHeight/o.CurrentFileModel.ImgCropWidth):e.Width=XJ.Data.GetInt(e.Height*o.CurrentFileModel.ImgCropWidth/o.CurrentFileModel.ImgCropHeight)};o.setEqualRatio=function(e){e?u.call(this,e):$.each(o.CurrentFileModel.ThumbImgSettings,function(e,t){u.call(this,t)})},o.initImgCrop=function(){$("img#ImgToEdit").removeAttr("style").hide().Jcrop({onSelect:function(){e.apply(this,arguments),o.$apply()},onChange:function(){e.apply(this,arguments),o.$apply()},onRelease:function(){0==o.CurrentFileModel.ImgCropWidth||0==o.CurrentFileModel.ImgCropWidth?this.setSelect([0,0,o.CurrentFileModel.ImgPreviewWidth,o.CurrentFileModel.ImgPreviewHeight]):this.setSelect([o.CurrentFileModel.X1,o.CurrentFileModel.Y1,o.CurrentFileModel.X2,o.CurrentFileModel.Y2])}},function(){(n=this).release.call(this)})},o.$watch("CurrentFileModel",function(e){try{e?(t.tabs("enableTab","文件详情"),t.tabs("enableTab","文件设置")):(t.tabs("select","选择文件"),t.tabs("disableTab","文件详情"),t.tabs("disableTab","文件设置"))}catch(e){}e&&o.setEqualRatio()},!0),o.init=function(){(l=new plupload.Uploader({browse_button:"btnAddFile",url:AppConfig.RootUrl+"Upload/UploadSubmit",file_data_name:"FileInfo",filters:{mime_types:[{title:"选择文件",extensions:window.AppConfig.AllowUploadExtInfo}],prevent_duplicates:!0},flash_swf_url:AppConfig.RootUrl+"Resources/src/js/plupload/Moxie.swf",silverlight_xap_url:AppConfig.RootUrl+"Resources/src/js/plupload/Moxie.xap"})).init(),l.bind("FilesAdded",function(e,t){var n=[];plupload.each(t,function(i){var l=new r;l.Id=i.id,l.Name=i.name,l.Size=plupload.formatSize(i.size),l.IsImage=XJ.ContentType.IsImage(i.type)&&!XJ.ContentType.IsGif(i.type),l.Format=i.name.slice(i.name.lastIndexOf(".")+1),function(e){if(e.file&&XJ.ContentType.IsImage(e.file.type)&&!XJ.ContentType.IsGif(e.file.type))if(XJ.ContentType.IsGif(e.file.type)){var t=new mOxie.FileReader;t.onload=function(){e.callback(t.result),t.destroy(),t=null},t.readAsDataURL(e.file.getSource())}else{var i=new mOxie.Image;i.onload=function(){e.callback&&e.callback(i),i.destroy(),i=null},i.load(e.file.getSource())}}({file:i,callback:function(e){l.ImgWidth=e.width,l.ImgHeight=e.height,l.Path=e.getAsDataURL(),e.downsize(180,180),l.ImgSmallPath=e.getAsDataURL();var t=new mOxie.Image;t.onload=function(){t.downsize(600,600),l.ImgBigPath=t.getAsDataURL(),l.ImgPreviewWidth=t.width,l.ImgPreviewHeight=t.height,l.ImgPreviewRatio=l.ImgPreviewWidth/l.ImgWidth,e.destroy(),e=null},t.load(i.getSource()),$("img#"+i.id).attr({src:l.ImgSmallPath})}}),n.push(l)}),o.FileModelList=XJ.Array.Concat(o.FileModelList,n),o.$apply()}),l.bind("BeforeUpload",function(e,t){s(!1);var i=$.map(o.FileModelList,function(e){return t.id==e.Id?e:null});i&&0<i.length&&(i[0].ImgSmallPath="",i[0].ImgBigPath="",i[0].Path=""),e.settings.multipart_params={FileSetting:JSON.stringify(i[0])}}),l.bind("UploadProgress",function(e,t){$("#fileUploaderProgress").progressbar("setValue",e.total.percent)}),l.bind("FileUploaded",function(e,t,i){var l=JSON.parse(i.response),n=a(t.id);n.UploadMsg=l.Message,n.IsUploadSuccess=l.IsSuccess,o.$apply()}),l.bind("UploadComplete",function(e,t){0==t.length&&art.dialog({icon:"face-smile",content:"当前没有待上传的文件！",ok:!0})})},o.init()}]),$(function(){var e=$("#tabFileUpload");e.tabs("disableTab","文件详情"),e.tabs("disableTab","文件设置")});
//# sourceMappingURL=app.js.map
